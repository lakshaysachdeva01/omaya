<%- include('header', {seoDetails}) %>

<!-- Start main-content -->
<section class="page-title" style="background-image: url(/assets/images/background/page-title-bg.png);">
    <div class="auto-container">
        <div class="title-outer text-center">
            <h1 class="title">Stays</h1>
            <ul class="page-breadcrumb">
                <li><a href="/">Home</a></li>
                <li>Stays</li>
            </ul>
        </div>
    </div>
</section>
<!-- end main-content -->

<!-- feature-section -->
<section class="feature-section">
    <div class="auto-container">
        <% if (stays && Array.isArray(stays) && stays.length > 0) { %>
            <% stays.forEach((item, index) => { %>
                <% 
                    // Alternate layout: even index (0, 2, 4...) = image left, content right
                    // odd index (1, 3, 5...) = content left, image right
                    const isReversed = index % 2 === 1;
                    const delay = (index + 1) * 100;
                %>
                <div class="row feature-row g-0 wow slideInUp" data-wow-delay="<%= delay %>ms">
                    <% if (isReversed) { %>
                        <!-- Content first, then image (reversed layout) -->
                        <div class="content-column col-lg-8 col-md-12 col-sm-12">
                            <div class="inner-column">
                                <div class="content-box">
                                    <div class="sec-title">
                                        <span class="sub-title" style="text-transform: uppercase;"><%= item.tagline %></span>
                                        <h2><%= item.title %></h2>
                                        <div class="text"><%= item.description %></div>
                                    </div>
                                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                                        <a href="<%= item.link || '#' %>" class="theme-btn btn-style-one read-more">Discover More</a>
                                        <a href="<%= item.link || '#' %>" class="theme-btn btn-style-one book-now-btn" style="background-color: #aa8453; color: white; border-color: #aa8453;">Book Now</a>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="image-column col-lg-4 col-md-12 col-sm-12">
                            <div class="inner-column" style="margin-top: 120px;">
                                <% 
                                    // Extract YouTube video ID from URL
                                    let youtubeVideoId = null;
                                    if (item.youtubeVideo) {
                                        const youtubeUrl = item.youtubeVideo;
                                        // Handle different YouTube URL formats
                                        if (youtubeUrl.includes('youtube.com/watch?v=')) {
                                            youtubeVideoId = youtubeUrl.split('v=')[1]?.split('&')[0];
                                        } else if (youtubeUrl.includes('youtu.be/')) {
                                            youtubeVideoId = youtubeUrl.split('youtu.be/')[1]?.split('?')[0];
                                        } else if (youtubeUrl.includes('youtube.com/embed/')) {
                                            youtubeVideoId = youtubeUrl.split('embed/')[1]?.split('?')[0];
                                        }
                                    }
                                %>
                                <div class="image-box product-details rd-page">
                                    <% if (youtubeVideoId) { %>
                                        <div class="youtube-player-container" id="youtube-player-reversed-<%= index %>" style="width: 100%; height: 100%; position: relative;">
                                            <!-- YouTube Player will be initialized here -->
                                            <div class="youtube-overlay-blocker"></div>
                                        </div>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    <% } else { %>
                        <!-- Image first, then content (normal layout) -->
                        <div class="image-column col-lg-4 col-md-12 col-sm-12">
                            <div class="inner-column" style="margin-top: 120px;">
                                <% 
                                    // Extract YouTube video ID from URL
                                    let youtubeVideoId = null;
                                    if (item.youtubeVideo) {
                                        const youtubeUrl = item.youtubeVideo;
                                        // Handle different YouTube URL formats
                                        if (youtubeUrl.includes('youtube.com/watch?v=')) {
                                            youtubeVideoId = youtubeUrl.split('v=')[1]?.split('&')[0];
                                        } else if (youtubeUrl.includes('youtu.be/')) {
                                            youtubeVideoId = youtubeUrl.split('youtu.be/')[1]?.split('?')[0];
                                        } else if (youtubeUrl.includes('youtube.com/embed/')) {
                                            youtubeVideoId = youtubeUrl.split('embed/')[1]?.split('?')[0];
                                        }
                                    }
                                %>
                                <div class="image-box product-details rd-page">
                                    <% if (youtubeVideoId) { %>
                                        <div class="youtube-player-container" id="youtube-player-<%= index %>" style="width: 100%; height: 100%; position: relative;">
                                            <!-- YouTube Player will be initialized here -->
                                            <div class="youtube-overlay-blocker"></div>
                                        </div>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                        <div class="content-column col-lg-8 col-md-12 col-sm-12">
                            <div class="inner-column">
                                <div class="content-box">
                                    <div class="sec-title">
                                        <span class="sub-title" style="text-transform: uppercase;"><%= item.tagline %></span>
                                        <h2><%= item.title %></h2>
                                        <div class="text"><%= item.description %></div>
                                    </div>
                                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                                        <a href="<%= item.link || '#' %>" class="theme-btn btn-style-one read-more">Discover More</a>
                                        <a href="<%= item.link || '#' %>" class="theme-btn btn-style-one book-now-btn" style="background-color: #aa8453; color: white; border-color: #aa8453;">Book Now</a>
                                    </div>

                                </div>
                            </div>
                        </div>
                    <% } %>
                </div>
            <% }); %>
        <% } %>
    </div>
</section>

<style>
    .feature-section .image-box {
        position: relative;
        width: 100%;
        overflow: hidden;
        height: 100%;
        background-size: cover !important;
        background-position: center !important;
        background-repeat: no-repeat !important;
        /* Background image should ALWAYS be visible */
    }

    .feature-section .book-now-btn:hover {
        background-color: var(--theme-color1, #222222) !important;
        color: white !important;
        border-color: var(--theme-color1, #222222) !important;
    }
    
    /* YouTube video player styles - ONLY for the container DIV, NOT iframe */
    .feature-section .image-box > div.youtube-player-container:not(iframe) {
        width: 100%;
        height: 100%;
        position: relative;
        overflow: hidden;
        user-select: none; /* Prevent text selection */
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        isolation: isolate;
        /* Container should NOT have background - background is on .image-box only */
        background: transparent !important;
        background-image: none !important;
    }
    
    /* CRITICAL: EXPLICITLY prevent iframe from getting background styles - target iframe directly */
    .feature-section iframe.youtube-player-container,
    .feature-section iframe[id^="youtube-player"],
    .feature-section .youtube-player-container iframe,
    .feature-section iframe {
        background: transparent !important;
        background-image: none !important;
        background-color: transparent !important;
        background-size: unset !important;
        background-position: unset !important;
        background-repeat: unset !important;
    }
    
    /* Block ALL interactions with iframe - no hover, no clicks, nothing */
    .feature-section .youtube-player-container iframe,
    .feature-section iframe.youtube-player-container,
    .feature-section iframe[id^="youtube-player"],
    .feature-section .image-box iframe {
        width: 100%;
        height: 100%;
        border: none;
        pointer-events: none !important; /* Block ALL iframe interactions - video autoplays so this is fine */
        -webkit-touch-callout: none;
        transform: translateZ(0) scale(1.45);
        -webkit-transform: translateZ(0) scale(1.45);
        transform-origin: center center;
        -webkit-transform-origin: center center;
        opacity: 1;
        position: relative;
        z-index: 1;
        /* CRITICAL: iframe must NEVER have background - background is on .image-box only */
        background-image: none !important;
        background: transparent !important;
        background-color: transparent !important;
        background-size: unset !important;
        background-position: unset !important;
        background-repeat: unset !important;
    }
    
    /* Full overlay to block ALL interactions including hover - ALWAYS ACTIVE */
    .feature-section .youtube-player-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 99999 !important;
        pointer-events: auto !important; /* Block ALL interactions including hover */
        background: transparent;
        cursor: default !important;
    }
    
    /* Additional overlay blocker element - ALWAYS ACTIVE */
    .feature-section .youtube-player-container .youtube-overlay-blocker {
        position: absolute !important;
        top: 0 !important;
        left: 0 !important;
        width: 100% !important;
        height: 100% !important;
        z-index: 100000 !important;
        pointer-events: auto !important; /* Block ALL interactions including hover */
        background: transparent !important;
        cursor: default !important;
        display: block !important;
    }
    
    /* Prevent any hover effects - overlays stay active on hover */
    .feature-section .youtube-player-container:hover::before {
        pointer-events: auto !important;
        z-index: 99999 !important;
    }
    
    .feature-section .youtube-player-container:hover .youtube-overlay-blocker {
        pointer-events: auto !important;
        z-index: 100000 !important;
    }
    
    /* Ensure overlays are always on top, even when YouTube adds elements */
    .feature-section .youtube-player-container * {
        z-index: auto;
    }
</style>

<!-- YouTube IFrame API -->
<script src="https://www.youtube.com/iframe_api"></script>

<script>
    // Store YouTube player instances
    var youtubePlayers = {};
    var youtubeVideoIds = {};
    
    // Set video IDs from server-side data
    <% if (stays && Array.isArray(stays) && stays.length > 0) { %>
        <% stays.forEach((item, index) => { %>
            <% 
                let youtubeVideoId = null;
                if (item.youtubeVideo) {
                    const youtubeUrl = item.youtubeVideo;
                    if (youtubeUrl.includes('youtube.com/watch?v=')) {
                        youtubeVideoId = youtubeUrl.split('v=')[1]?.split('&')[0];
                    } else if (youtubeUrl.includes('youtu.be/')) {
                        youtubeVideoId = youtubeUrl.split('youtu.be/')[1]?.split('?')[0];
                    } else if (youtubeUrl.includes('youtube.com/embed/')) {
                        youtubeVideoId = youtubeUrl.split('embed/')[1]?.split('?')[0];
                    }
                }
            %>
            <% if (youtubeVideoId) { %>
                youtubeVideoIds['youtube-player-<%= index %>'] = '<%= youtubeVideoId.replace(/'/g, "\\'") %>';
                youtubeVideoIds['youtube-player-reversed-<%= index %>'] = '<%= youtubeVideoId.replace(/'/g, "\\'") %>';
            <% } %>
        <% }); %>
    <% } %>
    
    // YouTube API ready callback
    function onYouTubeIframeAPIReady() {
        // Initialize players after a short delay to ensure DOM is ready
        setTimeout(initializeYouTubePlayers, 500);
    }
    
    // Initialize YouTube players
    function initializeYouTubePlayers() {
        // Find all YouTube player containers
        var containers = document.querySelectorAll('.youtube-player-container');
        
        containers.forEach(function(container) {
            var containerId = container.id;
            if (!containerId || youtubePlayers[containerId]) {
                return; // Already initialized
            }
            
            // Get video ID from our stored data
            var videoId = youtubeVideoIds[containerId];
            if (!videoId) {
                return;
            }
            
            // Create player with HD quality settings, autoplay, loop, muted, and no controls
            youtubePlayers[containerId] = new YT.Player(containerId, {
                videoId: videoId,
                width: '100%',
                height: '380',
                playerVars: {
                    'autoplay': 1, // Autoplay enabled
                    'mute': 1, // Muted
                    'loop': 1, // Loop enabled (requires playlist parameter)
                    'playlist': videoId, // Required for loop to work
                    'controls': 0, // No controls
                    'rel': 0, // Don't show related videos
                    'modestbranding': 1, // Minimal YouTube branding
                    'playsinline': 1,
                    'vq': 'hd2160', // Force HD quality
                    'enablejsapi': 1,
                    'iv_load_policy': 3, // Disable annotations
                    'cc_load_policy': 0, // Disable captions
                    'disablekb': 1, // Disable keyboard controls
                    'fs': 0, // Disable fullscreen button
                    'showinfo': 0, // Don't show video info
                    'origin': window.location.origin, // Required for some features
                    'widget_referrer': window.location.origin
                },
                events: {
                    'onReady': function(event) {
                        var player = event.target;
                        var iframe = document.getElementById(containerId);
                        
                        // Set HD quality immediately and repeatedly to ensure it sticks
                        try {
                            player.setPlaybackQuality('hd2160');
                            player.mute();
                            
                            // Force HD quality multiple times to ensure it's set before video plays
                            setTimeout(function() {
                                player.setPlaybackQuality('hd2160');
                            }, 50);
                            setTimeout(function() {
                                player.setPlaybackQuality('hd2160');
                            }, 150);
                            setTimeout(function() {
                                player.setPlaybackQuality('hd2160');
                            }, 300);
                            
                            // Ensure overlay blockers are in place
                            if (iframe && iframe.parentElement) {
                                var container = iframe.parentElement;
                                // Make sure overlay blocker exists
                                var blocker = container.querySelector('.youtube-overlay-blocker');
                                if (!blocker) {
                                    blocker = document.createElement('div');
                                    blocker.className = 'youtube-overlay-blocker';
                                    container.appendChild(blocker);
                                }
                                // Ensure iframe has no pointer events
                                iframe.style.pointerEvents = 'none';
                                
                                // CRITICAL: Remove any background from iframe immediately - use multiple methods
                                iframe.style.backgroundImage = 'none';
                                iframe.style.background = 'transparent';
                                iframe.style.backgroundColor = 'transparent';
                                iframe.style.backgroundSize = 'unset';
                                iframe.style.backgroundPosition = 'unset';
                                iframe.style.backgroundRepeat = 'unset';
                                
                                // Force remove via setProperty with important flag
                                iframe.style.setProperty('background-image', 'none', 'important');
                                iframe.style.setProperty('background', 'transparent', 'important');
                                iframe.style.setProperty('background-color', 'transparent', 'important');
                                iframe.style.setProperty('background-size', 'unset', 'important');
                                iframe.style.setProperty('background-position', 'unset', 'important');
                                iframe.style.setProperty('background-repeat', 'unset', 'important');
                            }
                            
                            // Continuously monitor and prevent pausing
                            setInterval(function() {
                                try {
                                    if (player.getPlayerState() === YT.PlayerState.PAUSED) {
                                        player.playVideo();
                                    }
                                    player.mute(); // Ensure it stays muted
                                } catch(e) {
                                    // Ignore errors
                                }
                            }, 500); // Check every 500ms
                        } catch(e) {
                            // Quality setting may not be available yet
                        }
                    },
                    'onStateChange': function(event) {
                        var player = event.target;
                        
                        // Prevent pausing - auto-resume if paused
                        if (event.data === YT.PlayerState.PAUSED) {
                            try {
                                player.playVideo();
                            } catch(e) {
                                // Ignore errors
                            }
                        }
                        // When video is buffering, cueing, or playing, force HD quality
                        if (event.data === YT.PlayerState.BUFFERING || 
                            event.data === YT.PlayerState.CUED || 
                            event.data === YT.PlayerState.PLAYING) {
                            try {
                                player.setPlaybackQuality('hd2160');
                                player.mute();
                            } catch(e) {
                                // Quality may not be available
                            }
                        }
                    },
                    'onPlaybackQualityChange': function(event) {
                        // If quality changes to something lower, force it back to HD
                        if (event.data !== 'hd2160' && event.data !== 'highres') {
                            try {
                                event.target.setPlaybackQuality('hd2160');
                            } catch(e) {
                                // Ignore errors
                            }
                        }
                    }
                }
            });
        });
    }
    
    // Fallback: If API loads after page load
    if (typeof YT !== 'undefined' && YT.Player) {
        onYouTubeIframeAPIReady();
    }
    
    // Prevent right-click context menu on YouTube players
    document.addEventListener('contextmenu', function(e) {
        if (e.target.closest('.youtube-player-container')) {
            e.preventDefault();
            return false;
        }
    }, false);
    
    // Prevent keyboard shortcuts that might pause/control video
    document.addEventListener('keydown', function(e) {
        if (e.target.closest('.youtube-player-container') || 
            (e.key === ' ' || e.key === 'k' || e.key === 'ArrowLeft' || e.key === 'ArrowRight')) {
            // Allow space and other keys only if not focused on video container
            if (document.activeElement && document.activeElement.closest('.youtube-player-container')) {
                e.preventDefault();
                return false;
            }
        }
    }, false);
    
    // Prevent drag and drop on video containers
    document.addEventListener('dragstart', function(e) {
        if (e.target.closest('.youtube-player-container')) {
            e.preventDefault();
            return false;
        }
    }, false);
    
    // Ensure all YouTube containers have overlays and blocked interactions
    function enforceYouTubeBlocking() {
        var containers = document.querySelectorAll('.youtube-player-container');
        containers.forEach(function(container) {
            var iframe = container.querySelector('iframe');
            if (iframe) {
                // Block all iframe interactions
                iframe.style.pointerEvents = 'none';
                
                // CRITICAL: Remove any background-image from iframe - it should NEVER have background
                // Use setProperty with important flag
                iframe.style.setProperty('background-image', 'none', 'important');
                iframe.style.setProperty('background', 'transparent', 'important');
                iframe.style.setProperty('background-color', 'transparent', 'important');
                iframe.style.setProperty('background-size', 'unset', 'important');
                iframe.style.setProperty('background-position', 'unset', 'important');
                iframe.style.setProperty('background-repeat', 'unset', 'important');
                
                // Also set via direct style properties
                iframe.style.backgroundImage = 'none';
                iframe.style.background = 'transparent';
                iframe.style.backgroundColor = 'transparent';
                iframe.style.backgroundSize = 'unset';
                iframe.style.backgroundPosition = 'unset';
                iframe.style.backgroundRepeat = 'unset';
                
                // Remove any data attributes
                iframe.removeAttribute('data-background-image');
                
                // Force override via setAttribute
                var currentStyle = iframe.getAttribute('style') || '';
                // Remove any existing background styles from the string
                currentStyle = currentStyle.replace(/background[^;]*;?/gi, '');
                // Add our forced styles
                iframe.setAttribute('style', 
                    currentStyle + 
                    'background-image: none !important; ' +
                    'background: transparent !important; ' +
                    'background-color: transparent !important; ' +
                    'background-size: unset !important; ' +
                    'background-position: unset !important; ' +
                    'background-repeat: unset !important; '
                );
                
                // Ensure overlay blocker exists
                var blocker = container.querySelector('.youtube-overlay-blocker');
                if (!blocker) {
                    blocker = document.createElement('div');
                    blocker.className = 'youtube-overlay-blocker';
                    container.appendChild(blocker);
                }
                blocker.style.cssText = 'position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 100000; pointer-events: auto !important; background: transparent; cursor: default;';
            }
        });
    }
    
    // Run immediately and continuously
    enforceYouTubeBlocking();
    setTimeout(enforceYouTubeBlocking, 100);
    setTimeout(enforceYouTubeBlocking, 500);
    setTimeout(enforceYouTubeBlocking, 1000);
    setInterval(enforceYouTubeBlocking, 2000);
    
    // Also run on any DOM changes
    if (window.MutationObserver) {
        var observer = new MutationObserver(function(mutations) {
            enforceYouTubeBlocking();
        });
        observer.observe(document.body, {
            childList: true,
            subtree: true
        });
    }
</script>


<%- include('footer') %>
